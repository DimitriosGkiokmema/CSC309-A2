datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

generator client {
  provider = "prisma-client-js"
}

enum RoleType {
  regular
  cashier
  manager
  superuser
}

enum TransactionType {
  purchase
  redemption
  adjustment
  event
  transfer
}

enum PromotionType {
  automatic
  onetime
}

model User {
  id          Int    @id @default(autoincrement())
  utorid      String  @unique
  name        String
  email       String  @unique
  password    String?
  birthday    DateTime?
  role        RoleType?
  points      Int
  avatarUrl   String?
  suspicious  Boolean
  verified    Boolean
  token       String 
  createdAt   DateTime
  expiresAt   DateTime
  lastLogin   DateTime?
  promotions  Promotion[]
  buyers      Transaction[] @relation("buyer")
  cashiers Transaction[] @relation("cashier")
  organizer    Event[] @relation("eventOrganizer")
  guest    Event[] @relation("eventGuest")
}

model Promotion {
  id           Int      @id @default(autoincrement())
  name         String
  description  String
  startTime    DateTime
  endTime      DateTime
  minSpending  Float? 
  rate         Float? 
  points       Int?
  user       User @relation(fields: [userId], references: [id])
  userId     Int
  transactions Transaction[]
}

model Transaction {
	id Int @id @default(autoincrement())
	utorid String //@unique
	type String
	spent Float
	date String
	earned Int
	amount Int
	sender String
	recipient String
	sent Int
	redeemed Int
	remark String
	relatedId Int
	processedBy String?
	suspicious Boolean
	user User @relation("buyer", fields: [utorid], references: [utorid])
	createdBy String //cashier id?
	cashier User @relation("cashier",fields: [createdBy], references: [utorid])
	promotionIds Promotion[]
}

model Event {
  id      Int @id @default(autoincrement())
  name    String
  description String
  location    String
  startTime   DateTime
  endTime     DateTime
  capacity    Int?
  pointsRemaining Int
  pointsTotal Int
  published   Boolean
  organizerId String
  organizers  User @relation("eventOrganizer", fields: [organizerId], references: [utorid]) // change to utorid list
  guestId String
  guests  User @relation("eventGuest", fields: [guestId], references: [utorid]) // change to utorid list
}
